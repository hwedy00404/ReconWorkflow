name: ğŸ“¸ Bulk Gowitness Screenshots

on:
  workflow_dispatch:
    inputs:
      urls_file:
        description: 'Ø§Ø³Ù… Ù…Ù„Ù Ø§Ù„Ù€ URLs (Ù…Ø«Ø§Ù„: urls.txt)'
        required: true
        default: 'urls.txt'
        type: string
      threads:
        description: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù€ threads (1-20)'
        required: false
        default: '10'
        type: string
      delay:
        description: 'ÙˆÙ‚Øª Ø§Ù„ØªØ£Ø®ÙŠØ± Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ'
        required: false
        default: '3'
        type: string
      timeout:
        description: 'Ù…Ù‡Ù„Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ'
        required: false
        default: '30'
        type: string

jobs:
  screenshot_job:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¦ Checkout Repository
        uses: actions/checkout@v4
      
      - name: ğŸ› ï¸ Setup Go Environment
        uses: actions/setup-go@v5
        with:
          go-version: '1.22'
      
      - name: ğŸŒ Install Chromium
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser
          echo "âœ… Chromium installed at: $(which chromium-browser)"
      
      - name: â¬‡ï¸ Install Gowitness
        run: go install github.com/sensepost/gowitness@latest
      
      - name: âœ… Verify URLs File
        run: |
          if [ ! -f "${{ github.event.inputs.urls_file || 'urls.txt' }}" ]; then
            echo "âŒ Ø§Ù„Ù…Ù„Ù ${{ github.event.inputs.urls_file || 'urls.txt' }} Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯!"
            exit 1
          fi
          echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù„Ù"
          echo "ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ù€ URLs:"
          wc -l < "${{ github.event.inputs.urls_file || 'urls.txt' }}"
      
      - name: ğŸƒ Run Gowitness Scan
        run: |
          export PATH=$PATH:$(go env GOPATH)/bin
          
          # ØªØ´ØºÙŠÙ„ Gowitness Ù…Ø¹ ÙƒØªØ§Ø¨Ø© ÙÙŠ database
          gowitness scan file \
            -f "${{ github.event.inputs.urls_file || 'urls.txt' }}" \
            --write-db \
            --screenshot-format png \
            --threads ${{ github.event.inputs.threads || '10' }} \
            --delay ${{ github.event.inputs.delay || '3' }} \
            --timeout ${{ github.event.inputs.timeout || '30' }}
          
          echo "âœ… ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØµÙˆÙŠØ±"
          
          # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¬Ù„Ø¯ screenshots ÙˆØ¹Ø¯ Ø§Ù„ØµÙˆØ±
          if [ -d "screenshots" ]; then
            echo "âœ… Ù…Ø¬Ù„Ø¯ screenshots Ù…ÙˆØ¬ÙˆØ¯"
            # Ø¹Ø¯ ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØµÙˆØ±
            PNG_COUNT=$(ls -1 screenshots/*.png 2>/dev/null | wc -l || echo 0)
            JPEG_COUNT=$(ls -1 screenshots/*.jpeg 2>/dev/null | wc -l || echo 0)
            JPG_COUNT=$(ls -1 screenshots/*.jpg 2>/dev/null | wc -l || echo 0)
            TOTAL=$((PNG_COUNT + JPEG_COUNT + JPG_COUNT))
            echo "ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙˆØ±: $TOTAL"
            echo "   - PNG: $PNG_COUNT"
            echo "   - JPEG: $JPEG_COUNT"
            echo "   - JPG: $JPG_COUNT"
            echo ""
            echo "ğŸ“¸ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯:"
            ls -lh screenshots/
          else
            echo "âŒ Ù…Ø¬Ù„Ø¯ screenshots Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯!"
            echo "ğŸ“‚ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:"
            ls -la
          fi
      
      - name: ğŸ“‹ Generate Summary Report
        run: |
          # Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„ØµÙˆØ± Ù…Ù† ÙƒÙ„ Ù†ÙˆØ¹
          PNG_COUNT=$(ls -1 screenshots/*.png 2>/dev/null | wc -l || echo 0)
          JPEG_COUNT=$(ls -1 screenshots/*.jpeg 2>/dev/null | wc -l || echo 0)
          JPG_COUNT=$(ls -1 screenshots/*.jpg 2>/dev/null | wc -l || echo 0)
          TOTAL=$((PNG_COUNT + JPEG_COUNT + JPG_COUNT))
          
          echo "# ğŸ“¸ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø³Ø­" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** \`${{ github.event.inputs.urls_file || 'urls.txt' }}\`" >> $GITHUB_STEP_SUMMARY
          echo "**Ø¹Ø¯Ø¯ Ø§Ù„Ù€ URLs:** $(wc -l < ${{ github.event.inputs.urls_file || 'urls.txt' }})" >> $GITHUB_STEP_SUMMARY
          echo "**Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØµÙˆØ±:** $TOTAL" >> $GITHUB_STEP_SUMMARY
          echo "  - ğŸŸ¦ PNG: $PNG_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "  - ğŸŸ¨ JPEG: $JPEG_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "  - ğŸŸ§ JPG: $JPG_COUNT" >> $GITHUB_STEP_SUMMARY
          echo "**Threads:** ${{ github.event.inputs.threads || '10' }}" >> $GITHUB_STEP_SUMMARY
          echo "**Delay:** ${{ github.event.inputs.delay || '3' }}s" >> $GITHUB_STEP_SUMMARY
          echo "**Timeout:** ${{ github.event.inputs.timeout || '30' }}s" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ“¥ Ø§Ù„ØµÙˆØ± Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Artifacts" >> $GITHUB_STEP_SUMMARY
          echo "Ù†Ø²Ù‘Ù„ Ø§Ù„ØµÙˆØ± Ù…Ù† Ù‚Ø³Ù… **Artifacts** ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø©" >> $GITHUB_STEP_SUMMARY
      
      - name: ğŸ“¤ Upload Screenshots as Artifact
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: gowitness-screenshots-${{ github.run_number }}
          path: |
            screenshots/*.png
            screenshots/*.jpg
            screenshots/*.jpeg
          if-no-files-found: warn
          retention-days: 30
      
      - name: ğŸ“¤ Upload Database (Optional)
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: gowitness-database-${{ github.run_number }}
          path: gowitness.sqlite3
          if-no-files-found: ignore
          retention-days: 7
